<!DOCTYPE html>
<html>
<head>
    <title>–ú–æ–Ω–∏—Ç–æ—Ä —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
        .container { max-width: 800px; margin: 0 auto; }
        .header { background: #4CAF50; color: white; padding: 20px; border-radius: 5px; }
        .sensors { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin: 20px 0; }
        .sensor-card { background: white; padding: 20px; border-radius: 5px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .sensor-value { font-size: 2.5em; font-weight: bold; margin: 10px 0; }
        .sensor-label { color: #666; font-size: 0.9em; }
        .temp { color: #e74c3c; }
        .humidity { color: #3498db; }
        .pressure { color: #9b59b6; }
        .chart-container { background: white; padding: 20px; border-radius: 5px; margin-top: 20px; }
        .last-update { text-align: center; margin: 10px 0; color: #666; }
        .status { display: inline-block; padding: 5px 10px; border-radius: 3px; font-size: 0.9em; }
        .online { background: #2ecc71; color: white; }
        .offline { background: #e74c3c; color: white; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üå°Ô∏è –ú–æ–Ω–∏—Ç–æ—Ä —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã</h1>
            <p>–£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ: {{ device_name }} | –ú–µ—Å—Ç–æ: {{ location }}</p>
            <p>–°—Ç–∞—Ç—É—Å: <span class="status {{ status_class }}">{{ status_text }}</span></p>
        </div>
        
        <div class="sensors">
            <div class="sensor-card">
                <div class="sensor-label">–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞</div>
                <div class="sensor-value temp" id="temp">--.-</div>
                <div>¬∞C</div>
            </div>
            
            <div class="sensor-card">
                <div class="sensor-label">–í–ª–∞–∂–Ω–æ—Å—Ç—å</div>
                <div class="sensor-value humidity" id="humidity">--.-</div>
                <div>%</div>
            </div>
            
            <div class="sensor-card">
                <div class="sensor-label">–î–∞–≤–ª–µ–Ω–∏–µ</div>
                <div class="sensor-value pressure" id="pressure">--.-</div>
                <div>–≥–ü–∞</div>
            </div>
        </div>
        
        <div class="last-update">
            –ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ: <span id="lastUpdate">--:--:--</span>
        </div>
        
        <div class="chart-container">
            <h3>–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–π —á–∞—Å</h3>
            <canvas id="tempChart" width="400" height="200"></canvas>
        </div>
    </div>
    
    <script>
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏–π
        async function updateData() {
            try {
                const response = await fetch('/api/current');
                const data = await response.json();
                
                if (data.success) {
                    document.getElementById('temp').textContent = data.temperature.toFixed(1);
                    document.getElementById('humidity').textContent = data.humidity.toFixed(1);
                    document.getElementById('pressure').textContent = data.pressure.toFixed(1);
                    document.getElementById('lastUpdate').textContent = 
                        new Date(data.timestamp).toLocaleTimeString();
                    
                    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞
                    const statusElem = document.querySelector('.status');
                    if (data.sensor_connected) {
                        statusElem.className = 'status online';
                        statusElem.textContent = '–î–∞—Ç—á–∏–∫ –ø–æ–¥–∫–ª—é—á–µ–Ω';
                    } else {
                        statusElem.className = 'status offline';
                        statusElem.textContent = '–î–∞—Ç—á–∏–∫ –æ—Ç–∫–ª—é—á–µ–Ω';
                    }
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞:', error);
            }
        }
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ –∏—Å—Ç–æ—Ä–∏–∏ –¥–ª—è –≥—Ä–∞—Ñ–∏–∫–∞
        async function loadChart() {
            try {
                const response = await fetch('/api/history?hours=1');
                const data = await response.json();
                
                if (data.success && data.data.length > 0) {
                    const ctx = document.getElementById('tempChart').getContext('2d');
                    
                    // –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–π –≥—Ä–∞—Ñ–∏–∫ –µ—Å–ª–∏ –µ—Å—Ç—å
                    if (window.tempChart) {
                        window.tempChart.destroy();
                    }
                    
                    const labels = data.data.map(d => 
                        new Date(d.timestamp).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})
                    );
                    const temps = data.data.map(d => d.temperature);
                    
                    window.tempChart = new Chart(ctx, {
                        type: 'line',
                        data: {
                            labels: labels,
                            datasets: [{
                                label: '–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ ¬∞C',
                                data: temps,
                                borderColor: '#e74c3c',
                                backgroundColor: 'rgba(231, 76, 60, 0.1)',
                                borderWidth: 2,
                                fill: true
                            }]
                        },
                        options: {
                            responsive: true,
                            scales: {
                                y: {
                                    beginAtZero: false
                                }
                            }
                        }
                    });
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –≥—Ä–∞—Ñ–∏–∫–∞:', error);
            }
        }
        
        // –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
        updateData();
        loadChart();
        setInterval(updateData, 10000); // –ö–∞–∂–¥—ã–µ 10 —Å–µ–∫—É–Ω–¥
        setInterval(loadChart, 60000);  // –ö–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É
        
        // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ –≥—Ä–∞—Ñ–∏–∫–∞ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ä–∞–∑–º–µ—Ä–∞ –æ–∫–Ω–∞
        window.addEventListener('resize', loadChart);
    </script>
    
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</body>
</html>